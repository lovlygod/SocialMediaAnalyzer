<UserControl x:Class="SocialMediaAnalyzerWPF.UserControls.UsernameSearchControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:local="clr-namespace:SocialMediaAnalyzerWPF.UserControls"
             xmlns:converters="clr-namespace:SocialMediaAnalyzerWPF.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             Name="UsernameSearchControlRoot">
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <Style x:Key="AnimatedTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource RoundedTextBoxStyle}">
            <EventSetter Event="Loaded" Handler="TextBox_Loaded" />
        </Style>
    </UserControl.Resources>
    
    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto"
                  Style="{StaticResource HiddenScrollViewerStyle}">
        <StackPanel Margin="20">
            <materialDesign:Card Style="{StaticResource RoundedCardStyle}">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="{DynamicResource UsernameSearchTitle}"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource MaterialDesignBody}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal">
                        <TextBox x:Name="UsernameTextBox"
                                 Style="{StaticResource AnimatedTextBoxStyle}"
                                 materialDesign:HintAssist.Hint="{DynamicResource EnterUsernamePlaceholder}"
                                 FontSize="16"
                                 Margin="0,0,15,0"
                                 Foreground="{DynamicResource MaterialDesignBody}"
                                 Background="{DynamicResource MaterialDesignCardBackground}"
                                 KeyDown="UsernameTextBox_KeyDown"
                                 Width="300"/>
                        
                        <Button x:Name="MyIPButton"
                                Content="{DynamicResource MyIPButton}"
                                Style="{StaticResource RoundedButtonStyle}"
                                Background="{DynamicResource PrimaryHueDarkBrush}"
                                Foreground="White"
                                FontSize="14"
                                FontWeight="Medium"
                                Margin="10,0,0,0"
                                Click="MyIPButton_Click"/>
                    </StackPanel>
                    
                    <Button x:Name="SearchButton"
                            Grid.Row="1"
                            Grid.Column="1"
                            Content="{DynamicResource SearchButton}"
                            Style="{StaticResource RoundedButtonStyle}"
                            Background="{DynamicResource SecondaryAccentBrush}"
                            Foreground="White"
                            FontSize="14"
                            FontWeight="Medium"
                            Click="SearchButton_Click"/>
                </Grid>
            </materialDesign:Card>

            <materialDesign:Card Style="{StaticResource RoundedCardStyle}">
                <Expander Header="{DynamicResource SearchResultsHeader}"
                          Margin="5"
                          Style="{StaticResource DarkExpanderStyle}">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0"
                                   Text="{DynamicResource ClickUrlHint}"
                                   FontSize="10"
                                   FontStyle="Italic"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                   Margin="0,0,0,10"
                                   HorizontalAlignment="Left"/>
                        <ListView x:Name="UsernameResultsListView"
                                  Grid.Row="1"
                                  ItemsSource="{Binding SearchResults, ElementName=UsernameSearchControlRoot}"
                                  MaxHeight="300"
                                  Background="{DynamicResource MaterialDesignCardBackground}"
                                  Foreground="{DynamicResource MaterialDesignBody}"
                                  BorderBrush="{DynamicResource MaterialDesignDivider}"
                                  ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                  ScrollViewer.CanContentScroll="True"
                                  Loaded="ListView_Loaded"
                                  Style="{StaticResource DarkListViewStyle}">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="{DynamicResource SocialNetworkColumn}" Width="150">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Platform}"
                                                           Foreground="{DynamicResource MaterialDesignBody}"
                                                           VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource UsernameColumn}" Width="150">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Username}"
                                                           Foreground="{DynamicResource MaterialDesignBody}"
                                                           VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource ProfileUrlColumn}" Width="300">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding ProfileUrl}"
                                                           Foreground="{DynamicResource SecondaryAccentBrush}"
                                                           VerticalAlignment="Center"
                                                           Cursor="Hand"
                                                           TextDecorations="Underline">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <EventSetter Event="MouseLeftButtonDown" Handler="ProfileUrl_MouseLeftButtonDown"/>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="{DynamicResource StatusColumn}" Width="100">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Status}"
                                                           Foreground="{DynamicResource MaterialDesignBody}"
                                                           VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="Background" Value="{DynamicResource MaterialDesignCardBackground}" />
                                    <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}" />
                                    <Setter Property="BorderThickness" Value="0" />
                                    <Setter Property="Padding" Value="5" />
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                </Style>
                            </ListView.ItemContainerStyle>
                        </ListView>
                    </Grid>
                </Expander>
            </materialDesign:Card>

            <materialDesign:Card Style="{StaticResource RoundedCardStyle}">
                <Expander Header="{DynamicResource SearchStatisticsHeader}"
                          Margin="5"
                          Style="{StaticResource DarkExpanderStyle}">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Margin="5" Tag="stat1">
                            <TextBlock Text="{Binding TotalPlatformsCount, ElementName=UsernameSearchControlRoot, StringFormat='{}{0}'}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource SecondaryAccentBrush}"/>
                            <TextBlock Text="{DynamicResource PlatformsText}"
                                       FontSize="12"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Margin="5" Tag="stat2">
                            <TextBlock Text="{Binding FoundProfilesCount, ElementName=UsernameSearchControlRoot, StringFormat='{}{0}'}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource SecondaryAccentBrush}"/>
                            <TextBlock Text="{DynamicResource FoundText}"
                                       FontSize="12"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2" Margin="5" Tag="stat3">
                            <TextBlock Text="{Binding NotFoundProfilesCount, ElementName=UsernameSearchControlRoot, StringFormat='{}{0}'}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource SecondaryAccentBrush}"/>
                            <TextBlock Text="{DynamicResource NotFoundText}"
                                       FontSize="12"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="3" Margin="5" Tag="stat4">
                            <TextBlock Text="{Binding SearchTime, ElementName=UsernameSearchControlRoot, StringFormat='{}{0:F2}s'}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource SecondaryAccentBrush}"/>
                            <TextBlock Text="{DynamicResource TimeText}"
                                       FontSize="12"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        </StackPanel>
                    </Grid>
                </Expander>
            </materialDesign:Card>

            <materialDesign:Card Style="{StaticResource RoundedCardStyle}">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <ProgressBar x:Name="SearchProgressBar"
                                 Grid.Column="0"
                                 Height="6"
                                 Margin="0,10,10,10"
                                 IsIndeterminate="True"
                                 Visibility="Collapsed"
                                 Style="{StaticResource AnimatedProgressBarStyle}"/>
                    
                    <TextBlock x:Name="ProgressTextBlock"
                               Grid.Column="1"
                               Text="{DynamicResource SearchCompleted}"
                               VerticalAlignment="Center"
                               Foreground="{DynamicResource MaterialDesignBody}"/>
                </Grid>
            </materialDesign:Card>
        </StackPanel>
    </ScrollViewer>
</UserControl>